# eksctl
- name: "eksctl - check exists"
  shell: eksctl version 2>&1 | head -n 1 | grep "{{ args.version }}"
  register: eksctl_exists
  changed_when: false
  ignore_errors: yes

- name: "eksctl - download"
  shell: curl -L "https://github.com/weaveworks/eksctl/releases/download/{{ args.version }}/eksctl_$(uname -s)_amd64.tar.gz" -o /tmp/eksctl_amd64.tar.gz
  when: eksctl_exists is failed

- name: "eksctl - unzip"
  become: yes
  unarchive:
    src: /tmp/eksctl_amd64.tar.gz
    dest: /usr/local/bin
    remote_src: yes
  when: eksctl_exists is failed

- name: "eksctl - remove tmp"
  file:
    path: /tmp/eksctl_amd64.tar.gz
    state: absent
  when: eksctl_exists is failed

- name: "eksctl - chmod"
  become: yes
  file:
    path: /usr/local/bin/eksctl
    mode: a+x
  when: eksctl_exists is failed
