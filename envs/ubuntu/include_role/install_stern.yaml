- name: "stern - check installed"
  shell: stern --version | grep {{ args.version }}
  register: stern_exists
  changed_when: false
  ignore_errors: yes

- name: "stern - download"
  get_url:
    url: https://github.com/stern/stern/releases/download/v{{ args.version }}/stern.tar.gz
    dest: "/tmp/stern.tar.gz"
  register: download_stern
  when: stern_exists is failed

- name: "helm unarchive"
  unarchive:
    src: "/tmp/stern.tar.gx"
    dest: /tmp
    remote_src: yes
  when: stern_exists is failed

- name: "stern - copy"
  become: yes
  copy:
    src: "/tmp/stern_{{ args.version }}_linux_amd64/stern"
    dest: /usr/local/bin/stern
    mode: a+x
  when: stern_exists is failed

- name: "stern - remove temp files"
  file:
    state: absent
    path: "{{ item }}"
  with_items:
    - "/tmp/stern.tar.gz"
    - "/tmp/stern_{{ args.version }}_linux_amd64/"
  when: stern_exists is failed

- name: "stern - change file permissions"
  become: yes
  file:
    path: /usr/local/bin/stern
    mode: "0755"
