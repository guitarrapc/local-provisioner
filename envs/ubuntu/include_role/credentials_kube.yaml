# .kube/config
- name: ".kube - check src .kub/config exists"
  stat:
    path: "{{ args.path }}"
  register: win_kube_config_stat_result

- name: ".kube - check .kube/config is link"
  stat:
    path: "{{ ansible_home }}/.kube/config"
  register: kube_config_link

- name: ".kube - create ~/.kube directory"
  file:
    path: "{{ ansible_home }}/.kube"
    state: directory
    mode: "0755"

- name: ".kube - delete ~/.kube/config default file"
  file:
    path: "{{ ansible_home }}/.kube"
    state: absent
  when: (win_kube_config_stat_result.stat.exists) and (kube_config_link.stat.exists) and (not kube_config_link.stat.islnk)

- name: ".kube - create ~/.kube/config symlinks"
  file:
    src: "{{ args.path }}"
    dest: "{{ ansible_home }}/.kube/config"
    state: link
  when: win_kube_config_stat_result.stat.exists
