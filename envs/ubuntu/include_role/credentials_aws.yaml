# https://github.com/aws/aws-cli/releases
- name: ".aws - check src .aws/credentials exists"
  stat:
    path: "{{ args.path }}/credentials"
  register: win_aws_credentials_stat_result

- name: ".aws - check src .aws/config exists"
  stat:
    path: "{{ args.path }}/config"
  register: win_aws_config_stat_result

- name: ".aws - check .aws/credentials is link"
  stat:
    path: "{{ ansible_home }}/.aws/credentials"
  register: aws_credentials_link

- name: ".aws - check .aws/config is link"
  stat:
    path: "{{ ansible_home }}/.aws/config"
  register: aws_config_link

- name: "aws -Create .aws directory"
  file:
    path: "{{ ansible_home }}/.aws"
    state: directory

- name: ".aws - delete ~/.aws/credentials default file"
  file:
    path: "{{ ansible_home }}/.aws/credentials"
    state: absent
  when: (win_aws_credentials_stat_result.stat.exists) and (aws_credentials_link.stat.exists) and (not aws_credentials_link.stat.islnk)

- name: ".aws - delete ~/.aws/config default file"
  file:
    path: "{{ ansible_home }}/.aws/config"
    state: absent
  when: (win_aws_config_stat_result.stat.exists) and (aws_config_link.stat.exists) and (not aws_config_link.stat.islnk)

- name: ".aws - create ~/.aws/credentials symlinks"
  file:
    src: "{{args.path}}/credentials"
    dest: "{{ ansible_home }}/.aws/credentials"
    state: link
  when: win_aws_credentials_stat_result.stat.exists

- name: ".aws - create ~/.aws/config symlinks"
  file:
    src: "{{args.path}}/config"
    dest: "{{ ansible_home }}/.aws/config"
    state: link
  when: win_aws_config_stat_result.stat.exists
