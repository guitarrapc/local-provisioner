---
# krew: https://krew.sigs.k8s.io/docs/user-guide/setup/install/
- name: "kubectl_plugin ({{ args.name }}) - check installed"
  shell: "kubectl {{ args.name }} {{ args.install_check_arg }} 2>&1"
  register: kubectl_plugin_exists
  changed_when: false
  ignore_errors: yes

- name: "kubectl_plugin ({{ args.name }}) - install"
  shell: |
    export PATH="${KREW_ROOT:-{{ ansible_home }}/.krew}/bin:$PATH"
    kubectl krew install {{ args.name }}
  when: kubectl_plugin_exists is failed
